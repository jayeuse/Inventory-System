<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transactions</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/static/TransactionPage/TransactionPage.css" />
  </head>
  <body>
    <div class="d-flex">
      <!-- Sidebar Container -->
      <div id="sidebar-container"></div>

      <main class="main flex-grow-1 p-4">
        <div class="tabs">
          <div class="tab active" data-tab="history">Transaction History</div>
        </div>

        <!-- Transaction History Content -->
        <div id="history-content" class="tab-content active">
          <div class="card">
            <div class="search-row">
              <div class="search-controls">
                <input
                  class="input search-input"
                  placeholder="Search by Transaction ID, Product ID, Product Name, or Batch ID"
                  id="transactions_searchInput"
                />
                <select class="input" id="transactions_typeFilter">
                  <option value="all">Filter by Type</option>
                  <option value="in">Stock In</option>
                  <option value="out">Stock Out</option>
                  <option value="adjust">Adjust</option>
                </select>
              </div>
            </div>

            <!-- Transaction Table -->
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Transaction ID</th>
                    <th>Type</th>
                    <th>Product Name</th>
                    <th>Batch ID</th>
                    <th>Qty Change</th>
                    <th>On Hand</th>
                    <th>Remarks</th>
                    <th>Performed By</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="transactions_tableBody">
                  <tr>
                    <td> </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="pagination">
              <button class="pagination-btn" id="transactions_prevBtn">
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <button class="pagination-btn" id="transactions_nextBtn">
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Sidebar Initialization Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Load sidebar component
        fetch("/static/Sidebar/Sidebar.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("sidebar-container").innerHTML = data;
            initializeSidebar();
          })
          .catch((error) => {
            console.error("Error loading sidebar:", error);
          });

        function initializeSidebar() {
          const navIcons = document.querySelectorAll(
            ".sidebar-component .nav-icon"
          );
          const navLabels = document.querySelectorAll(
            ".sidebar-component .nav-label"
          );

          // Get current page URL
          const currentUrl = window.location.href.toLowerCase();
          console.log("Current URL:", currentUrl);

          // Remove active class from all items first
          navIcons.forEach((icon) => icon.classList.remove("active"));
          navLabels.forEach((label) => label.classList.remove("active"));

          // Set active item for transactions page
          let activeItem = null;

          if (currentUrl.includes("/transactions")) {
            activeItem = "transactions";
          } else if (currentUrl.includes("/settings")) {
            activeItem = "settings";
          } else if (currentUrl.includes("/products")) {
            activeItem = "products";
          } else if (currentUrl.includes("/inventory")) {
            activeItem = "inventory";
          } else {
            activeItem = "dashboard";
          }

          console.log("Detected active item:", activeItem);

          // Set active state
          if (activeItem) {
            const activeIcon = document.querySelector(
              `.sidebar-component .nav-icon[data-item="${activeItem}"]`
            );
            const activeLabel = document.querySelector(
              `.sidebar-component .nav-label[data-item="${activeItem}"]`
            );

            if (activeIcon) {
              activeIcon.classList.add("active");
            }
            if (activeLabel) {
              activeLabel.classList.add("active");
            }
          }

          // Add click handlers for navigation
          navIcons.forEach((icon) => {
            icon.addEventListener("click", function () {
              const path = this.getAttribute("data-path");
              const item = this.getAttribute("data-item");

              if (path && item !== "logout") {
                window.location.href = path;
              }
            });
          });

          navLabels.forEach((label) => {
            label.addEventListener("click", function () {
              const path = this.getAttribute("data-path");
              const item = this.getAttribute("data-item");

              if (path && item !== "logout") {
                window.location.href = path;
              }
            });
          });

          // Logout handlers
          const logoutIcon = document.querySelector(
            ".sidebar-component .logout-icon"
          );
          const logoutLabel = document.querySelector(
            ".sidebar-component .logout-label"
          );

          if (logoutIcon) {
            logoutIcon.addEventListener("click", function () {
              console.log("Logout clicked");
              // Add your logout logic here
            });
          }

          if (logoutLabel) {
            logoutLabel.addEventListener("click", function () {
              console.log("Logout clicked");
              // Add your logout logic here
            });
          }

          // Sync hover states
          navIcons.forEach((icon) => {
            const item = icon.getAttribute("data-item");

            icon.addEventListener("mouseenter", function () {
              const label = document.querySelector(
                `.sidebar-component .nav-label[data-item="${item}"]`
              );
              if (label && !label.classList.contains("active")) {
                label.style.backgroundColor = "var(--white)";
                label.style.color = "var(--violet-medium)";
              }
            });

            icon.addEventListener("mouseleave", function () {
              const label = document.querySelector(
                `.sidebar-component .nav-label[data-item="${item}"]`
              );
              if (label && !label.classList.contains("active")) {
                label.style.backgroundColor = "";
                label.style.color = "";
              }
            });
          });

          navLabels.forEach((label) => {
            const item = label.getAttribute("data-item");

            label.addEventListener("mouseenter", function () {
              const icon = document.querySelector(
                `.sidebar-component .nav-icon[data-item="${item}"]`
              );
              if (icon && !icon.classList.contains("active")) {
                icon.style.backgroundColor = "var(--white)";
                icon.style.color = "var(--violet-darker)";
              }
            });

            label.addEventListener("mouseleave", function () {
              const icon = document.querySelector(
                `.sidebar-component .nav-icon[data-item="${item}"]`
              );
              if (icon && !icon.classList.contains("active")) {
                icon.style.backgroundColor = "";
                icon.style.color = "";
              }
            });
          });
        }
      });
    </script>

    <script src="/static/utils/csrf.js"></script>
    <script src="/static/utils/permissions.js"></script>
    <script src="/static/SettingsPage/LogoutManagement/LogoutManagement.js"></script>
    <script src="/static/TransactionPage/TransactionPage.js"></script>
    <script src="/static/TransactionPage/TransactionManagement/TransactionManagement.js"></script>
  </body>
</html>